<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APE Admin Panel</title>
    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', 'Helvetica Neue', sans-serif;
    background: #050811;
    color: #e0e7ff;
    line-height: 1.6;
    padding: 40px;
}

.container {
    max-width: 1400px;
    margin: 0 auto;
}

header {
    text-align: center;
    margin-bottom: 48px;
}

h1 {
    font-size: 36px;
    color: #60a5fa;
    margin-bottom: 12px;
    font-weight: 700;
}

.subtitle {
    color: #94a3b8;
    font-size: 16px;
}

.back-link {
    display: inline-block;
    color: #60a5fa;
    text-decoration: none;
    margin-bottom: 32px;
    font-weight: 500;
    transition: all 0.2s ease;
}

.back-link:hover {
    color: #3b82f6;
}

.panels-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 32px;
    margin-bottom: 48px;
}

.panel {
    background: linear-gradient(145deg, #0f1629 0%, #0a0f1e 100%);
    border: 1px solid rgba(99, 179, 237, 0.15);
    border-radius: 20px;
    padding: 40px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
    transition: all 0.3s ease;
}

.panel:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.5);
}

.panel.buy-panel {
    border-top: 3px solid #10b981;
}

.panel.sell-panel {
    border-top: 3px solid #ef4444;
}

.panel-header {
    margin-bottom: 32px;
    text-align: center;
}

.panel-header h2 {
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 8px;
}

.panel.buy-panel h2 {
    color: #10b981;
}

.panel.sell-panel h2 {
    color: #ef4444;
}

.panel-header p {
    color: #94a3b8;
    font-size: 14px;
}

.success-message {
    display: none;
    background: rgba(16, 185, 129, 0.15);
    border: 1px solid rgba(16, 185, 129, 0.3);
    color: #10b981;
    padding: 16px;
    border-radius: 10px;
    margin-bottom: 24px;
    text-align: center;
    font-weight: 600;
}

.success-message.show {
    display: block;
    animation: slideIn 0.3s ease;
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.form-group {
    margin-bottom: 24px;
}

.form-group label {
    display: block;
    color: #94a3b8;
    font-size: 12px;
    margin-bottom: 10px;
    font-weight: 600;
    letter-spacing: 0.5px;
    text-transform: uppercase;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    background: rgba(99, 179, 237, 0.05);
    border: 1px solid rgba(99, 179, 237, 0.2);
    color: #e0e7ff;
    padding: 14px 16px;
    border-radius: 10px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    font-size: 14px;
    transition: all 0.3s ease;
}

.form-group textarea {
    resize: vertical;
    min-height: 80px;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: #60a5fa;
    background: rgba(99, 179, 237, 0.08);
    box-shadow: 0 0 0 3px rgba(99, 179, 237, 0.1);
}

.image-upload-area {
    border: 2px dashed rgba(99, 179, 237, 0.3);
    border-radius: 10px;
    padding: 24px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    background: rgba(99, 179, 237, 0.03);
}

.image-upload-area:hover {
    border-color: #60a5fa;
    background: rgba(99, 179, 237, 0.08);
}

.image-upload-area.has-image {
    border-style: solid;
    border-color: #10b981;
}

.image-preview {
    display: none;
    margin-top: 16px;
}

.image-preview img {
    max-width: 100px;
    max-height: 100px;
    border-radius: 8px;
    border: 2px solid rgba(99, 179, 237, 0.2);
}

.image-preview.show {
    display: block;
}

.upload-text {
    color: #94a3b8;
    font-size: 13px;
}

.upload-text strong {
    color: #60a5fa;
}

input[type="file"] {
    display: none;
}

.submit-btn {
    width: 100%;
    border: none;
    color: white;
    padding: 16px;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 15px;
    letter-spacing: 0.3px;
    text-transform: uppercase;
    margin-top: 12px;
}

.buy-panel .submit-btn {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);
}

.buy-panel .submit-btn:hover {
    background: linear-gradient(135deg, #059669 0%, #047857 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
}

.sell-panel .submit-btn {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    box-shadow: 0 4px 16px rgba(239, 68, 68, 0.3);
}

.sell-panel .submit-btn:hover {
    background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
}

.recent-trades {
    background: linear-gradient(145deg, #0f1629 0%, #0a0f1e 100%);
    border: 1px solid rgba(99, 179, 237, 0.15);
    border-radius: 20px;
    padding: 32px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
}

.recent-trades h2 {
    color: #60a5fa;
    font-size: 20px;
    margin-bottom: 24px;
    font-weight: 600;
}

table {
    width: 100%;
    border-collapse: collapse;
}

thead {
    border-bottom: 1px solid rgba(99, 179, 237, 0.15);
}

th {
    text-align: left;
    padding: 14px 16px;
    font-size: 11px;
    color: #94a3b8;
    font-weight: 600;
    letter-spacing: 1px;
    text-transform: uppercase;
}

td {
    padding: 16px;
    font-size: 14px;
    border-bottom: 1px solid rgba(99, 179, 237, 0.08);
    color: #cbd5e1;
}

.token-info {
    display: flex;
    align-items: center;
    gap: 12px;
}

.token-icon {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid rgba(99, 179, 237, 0.2);
}

.type-badge {
    padding: 5px 12px;
    border-radius: 6px;
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.5px;
    text-transform: uppercase;
}

.type-badge.buy {
    background: rgba(16, 185, 129, 0.15);
    color: #10b981;
    border: 1px solid rgba(16, 185, 129, 0.3);
}

.type-badge.sell {
    background: rgba(239, 68, 68, 0.15);
    color: #ef4444;
    border: 1px solid rgba(239, 68, 68, 0.3);
}

@media (max-width: 1200px) {
    .panels-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    body {
        padding: 20px;
    }
    
    .panel {
        padding: 24px;
    }
}
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Back to Dashboard</a>
        
        <header>
            <h1>APE Admin Panel</h1>
            <p class="subtitle">Add buy and sell trades</p>
        </header>

        <div class="panels-grid">
            <!-- BUY PANEL -->
            <div class="panel buy-panel">
                <div class="panel-header">
                    <h2>BUY TRADE</h2>
                    <p>Record a token purchase</p>
                </div>

                <div class="success-message" id="buySuccessMessage">
                    Buy trade added successfully!
                </div>

                <form id="buyForm">
                    <div class="form-group">
                        <label>Token Ticker</label>
                        <input type="text" id="buyTicker" placeholder="e.g., BONK, WIF, POPCAT" required>
                    </div>

                    <div class="form-group">
                        <label>Token Address</label>
                        <input type="text" id="buyTokenAddress" placeholder="Solana token address" required>
                    </div>

                    <div class="form-group">
                        <label>Amount of Tokens</label>
                        <input type="number" id="buyAmount" step="0.000001" placeholder="0.00" required>
                    </div>

                    <div class="form-group">
                        <label>Total Value (USD)</label>
                        <input type="number" id="buyTotalValue" step="0.01" placeholder="0.00" required>
                    </div>

                    <div class="form-group">
                        <label>Transaction Hash</label>
                        <input type="text" id="buyTxHash" placeholder="Solana transaction hash" required>
                    </div>

                    <div class="form-group">
                        <label>Token Image</label>
                        <div class="image-upload-area" id="buyImageUpload">
                            <input type="file" id="buyImageInput" accept="image/*">
                            <div class="upload-text">
                                <strong>Click to upload</strong> or drag and drop<br>
                                PNG, JPG, WebP (max 2MB)
                            </div>
                            <div class="image-preview" id="buyImagePreview">
                                <img id="buyImagePreviewImg" src="" alt="Preview">
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="submit-btn">Add Buy Trade</button>
                </form>
            </div>

            <!-- SELL PANEL -->
            <div class="panel sell-panel">
                <div class="panel-header">
                    <h2>SELL TRADE</h2>
                    <p>Record a token sale</p>
                </div>

                <div class="success-message" id="sellSuccessMessage">
                    Sell trade added successfully!
                </div>

                <form id="sellForm">
                    <div class="form-group">
                        <label>Token Ticker</label>
                        <input type="text" id="sellTicker" placeholder="e.g., BONK, WIF, POPCAT" required>
                    </div>

                    <div class="form-group">
                        <label>Token Address</label>
                        <input type="text" id="sellTokenAddress" placeholder="Solana token address" required>
                    </div>

                    <div class="form-group">
                        <label>Amount of Tokens</label>
                        <input type="number" id="sellAmount" step="0.000001" placeholder="0.00" required>
                    </div>

                    <div class="form-group">
                        <label>Total Value (USD)</label>
                        <input type="number" id="sellTotalValue" step="0.01" placeholder="0.00" required>
                    </div>

                    <div class="form-group">
                        <label>Transaction Hash</label>
                        <input type="text" id="sellTxHash" placeholder="Solana transaction hash" required>
                    </div>

                    <div class="form-group">
                        <label>Token Image</label>
                        <div class="image-upload-area" id="sellImageUpload">
                            <input type="file" id="sellImageInput" accept="image/*">
                            <div class="upload-text">
                                <strong>Click to upload</strong> or drag and drop<br>
                                PNG, JPG, WebP (max 2MB)
                            </div>
                            <div class="image-preview" id="sellImagePreview">
                                <img id="sellImagePreviewImg" src="" alt="Preview">
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="submit-btn">Add Sell Trade</button>
                </form>
            </div>
        </div>

        <div class="recent-trades">
            <h2>Recent Trades</h2>
            <table>
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Type</th>
                        <th>Token</th>
                        <th>Amount</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody id="recentTradesBody">
                    <tr>
                        <td colspan="5" style="text-align: center; color: #64748b; padding: 40px;">No trades yet</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';
        import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js';

        const firebaseConfig = {
            apiKey: "AIzaSyCS3qi9luuIr7WmghMfRXTIxprT4m2v8sQ",
            authDomain: "apee-15ea0.firebaseapp.com",
            projectId: "apee-15ea0",
            storageBucket: "apee-15ea0.firebasestorage.app",
            messagingSenderId: "138789462447",
            appId: "1:138789462447:web:67cf87ffce73d845e90f5a",
            measurementId: "G-S6B3K5GGM2"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // Image upload handling for Buy
        let buyImageFile = null;
        const buyImageUpload = document.getElementById('buyImageUpload');
        const buyImageInput = document.getElementById('buyImageInput');
        const buyImagePreview = document.getElementById('buyImagePreview');
        const buyImagePreviewImg = document.getElementById('buyImagePreviewImg');

        buyImageUpload.addEventListener('click', () => buyImageInput.click());
        
        buyImageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file && file.size <= 2 * 1024 * 1024) { // 2MB limit
                buyImageFile = file;
                const reader = new FileReader();
                reader.onload = (e) => {
                    buyImagePreviewImg.src = e.target.result;
                    buyImagePreview.classList.add('show');
                    buyImageUpload.classList.add('has-image');
                };
                reader.readAsDataURL(file);
            } else {
                alert('Image must be less than 2MB');
            }
        });

        // Image upload handling for Sell
        let sellImageFile = null;
        const sellImageUpload = document.getElementById('sellImageUpload');
        const sellImageInput = document.getElementById('sellImageInput');
        const sellImagePreview = document.getElementById('sellImagePreview');
        const sellImagePreviewImg = document.getElementById('sellImagePreviewImg');

        sellImageUpload.addEventListener('click', () => sellImageInput.click());
        
        sellImageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file && file.size <= 2 * 1024 * 1024) {
                sellImageFile = file;
                const reader = new FileReader();
                reader.onload = (e) => {
                    sellImagePreviewImg.src = e.target.result;
                    sellImagePreview.classList.add('show');
                    sellImageUpload.classList.add('has-image');
                };
                reader.readAsDataURL(file);
            } else {
                alert('Image must be less than 2MB');
            }
        });

        // Upload image to Firebase Storage
        async function uploadTokenImage(file, tokenAddress) {
            if (!file) return null;
            
            const storageRef = ref(storage, `tokens/${tokenAddress}_${Date.now()}`);
            await uploadBytes(storageRef, file);
            return await getDownloadURL(storageRef);
        }

        // Buy Form Submission
        document.getElementById('buyForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const ticker = document.getElementById('buyTicker').value.toUpperCase();
            const tokenAddress = document.getElementById('buyTokenAddress').value;
            const amount = parseFloat(document.getElementById('buyAmount').value);
            const totalValue = parseFloat(document.getElementById('buyTotalValue').value);
            const txHash = document.getElementById('buyTxHash').value;
            const pricePerToken = totalValue / amount;

            try {
                // Upload image if provided
                let imageUrl = null;
                if (buyImageFile) {
                    imageUrl = await uploadTokenImage(buyImageFile, tokenAddress);
                }

                const trade = {
                    type: 'BUY',
                    symbol: ticker,
                    tokenAddress: tokenAddress,
                    amount: amount,
                    pricePerToken: pricePerToken,
                    value: totalValue,
                    txHash: txHash,
                    imageUrl: imageUrl,
                    timestamp: Date.now()
                };

                await addDoc(collection(db, 'trades'), trade);
                
                // Show success message
                const successMsg = document.getElementById('buySuccessMessage');
                successMsg.classList.add('show');
                setTimeout(() => successMsg.classList.remove('show'), 3000);

                // Reset form
                document.getElementById('buyForm').reset();
                buyImageFile = null;
                buyImagePreview.classList.remove('show');
                buyImageUpload.classList.remove('has-image');
                
                loadRecentTrades();
            } catch (error) {
                console.error('Error adding buy trade:', error);
                alert('Error adding trade: ' + error.message);
            }
        });

        // Sell Form Submission
        document.getElementById('sellForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const ticker = document.getElementById('sellTicker').value.toUpperCase();
            const tokenAddress = document.getElementById('sellTokenAddress').value;
            const amount = parseFloat(document.getElementById('sellAmount').value);
            const totalValue = parseFloat(document.getElementById('sellTotalValue').value);
            const txHash = document.getElementById('sellTxHash').value;
            const pricePerToken = totalValue / amount;

            try {
                // Upload image if provided
                let imageUrl = null;
                if (sellImageFile) {
                    imageUrl = await uploadTokenImage(sellImageFile, tokenAddress);
                }

                const trade = {
                    type: 'SELL',
                    symbol: ticker,
                    tokenAddress: tokenAddress,
                    amount: amount,
                    pricePerToken: pricePerToken,
                    value: totalValue,
                    txHash: txHash,
                    imageUrl: imageUrl,
                    timestamp: Date.now()
                };

                await addDoc(collection(db, 'trades'), trade);
                
                // Show success message
                const successMsg = document.getElementById('sellSuccessMessage');
                successMsg.classList.add('show');
                setTimeout(() => successMsg.classList.remove('show'), 3000);

                // Reset form
                document.getElementById('sellForm').reset();
                sellImageFile = null;
                sellImagePreview.classList.remove('show');
                sellImageUpload.classList.remove('has-image');
                
                loadRecentTrades();
            } catch (error) {
                console.error('Error adding sell trade:', error);
                alert('Error adding trade: ' + error.message);
            }
        });

        // Load recent trades
        async function loadRecentTrades() {
            try {
                const tradesQuery = query(collection(db, 'trades'), orderBy('timestamp', 'desc'), limit(10));
                const snapshot = await getDocs(tradesQuery);
                
                const tbody = document.getElementById('recentTradesBody');
                
                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #64748b; padding: 40px;">No trades yet</td></tr>';
                    return;
                }

                tbody.innerHTML = '';
                snapshot.forEach((doc) => {
                    const trade = doc.data();
                    const date = new Date(trade.timestamp);
                    const time = date.toLocaleString('en-US', { 
                        month: 'short', 
                        day: 'numeric', 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${time}</td>
                        <td><span class="type-badge ${trade.type.toLowerCase()}">${trade.type}</span></td>
                        <td>
                            <div class="token-info">
                                ${trade.imageUrl ? `<img src="${trade.imageUrl}" class="token-icon" alt="${trade.symbol}">` : ''}
                                <strong>${trade.symbol}</strong>
                            </div>
                        </td>
                        <td>${trade.amount.toFixed(4)}</td>
                        <td>$${trade.value.toFixed(2)}</td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading trades:', error);
            }
        }

        // Load on page load
        loadRecentTrades();
    </script>
</body>
</html>
